Berserker_Stat_Config:
  type: yaml data
  Default_Mana: 0
  Class_Resource: Rage
  Default_Skill_List: li@i@Cleave|i@Battle_Cry|i@Overpower
  Health: 150
  Melee_Damage: 8

Berserker_Skill_Config:
  type: yaml data
  ## Cleave ##
  Cleave_Cooldown: 3
  Cleave_Damage: 15
  Cleave_Range: 6
  Cleave_Cost: 3
  ## Battle Cry ##
  Battle_Cry_Cooldown: 16
  Battle_Cry_Duration: 6
  Battle_Cry_Buff: 0.2
  Battle_Cry_Cost: 4
  ## Overpower ##
  Overpower_Range: 6
  Overpower_Cooldown: 3
  Overpower_Damage: 35
  Overpower_Stun_Duration: 2
  Overpower_Cost: 5
  Overpower_Message: "<&a><&l>[Skill] <&f><player.name> <&7>has used <&f><def[Skill].to_titlecase.replace[_].with[<&sp>]> <&7>on <&f><def[target].name><&7>!"
  ## Leap ##
  Leap_Damage: 15
  Leap_Cooldown: 20
  Leap_Stun_Duration: 2.5
  Leap_Radius: 3
  Leap_Cost: 0
  ## Axe_Throw ##
  Axe_Throw_Cooldown: 10
  Axe_Throw_Ticks: 5
  Axe_Throw_Period: 3
  Axe_Throw_Damage: 5
  Axe_Throw_Cost: 3
  ## Hamstring ##
  Hamstring_Cooldown: 8
  Hamstring_Duration: 5
  Hamstring_Power: 1
  Hamstring_Damage: 10
  Hamstring_Debuff: 0.2
  Hamstring_Cost: 2
  ## Enraged_Regeneration ##
  Enraged_Regeneration_Cooldown: 30
  Enraged_Regeneration_Heal_Procentage: 0.05
  Enraged_Regeneration_Repeat: 5
  Enraged_Regeneration_Interval: 3
  Enraged_Regeneration_Cost: 4

Berserker_World_Handler:
  type: world
  debug: false
  events:
    on player damages entity:
    - if <player.flag[Class]> == Berserker && !<player.has_flag[Stun_Effect]> {
      - if <context.cause> == entity_attack {
        - define Mana <yaml[<player.uuid>].read[General.Mana].as_int>
        - if <def[Mana].add[2]> >= 20 {
          - yaml id:<player.uuid> set General.Mana:20
          - adjust <player> fake_experience:1.0|20
        }
        else if <def[Mana]> < 18 {
          - yaml id:<player.uuid> set General.Mana:<def[Mana].add[2]>
          - define Mana <def[Mana].add[2]>
          - adjust <player> fake_experience:<def[Mana].div[20]>|<def[Mana]>
        }
        - if <util.random.int[1].to[100].is[OR_MORE].than[90]> && !<player.has_flag[Enraged]> {
          - flag <player> Enraged duration:3s
        }
      }
    }

Berserker_Skills_Menu:
  type: Inventory
  debug: false
  title: <&6><&l>Berserker Skills<&co>
  size: 36
  slots:
  - "[i@Cleave] [i@Battle_Cry] [i@Overpower] [i@Inner_Rage] [] [] [] [] []"
  - "[i@Leap] [i@Axe_Throw] [i@Hamstring] [i@Enraged_Regeneration] [] [] [] [] []"
  - "[i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon] [i@Filler_Icon]"
  - "[i@<player.inventory.slot[1].scriptname||Unassigned_Skill>[quantity=1]] [i@<player.inventory.slot[2].scriptname||Unassigned_Skill>[quantity=1]] [i@<player.inventory.slot[3].scriptname||Unassigned_Skill>[quantity=1]] [i@<player.inventory.slot[4].scriptname||Unassigned_Skill>[quantity=1]] [i@<player.inventory.slot[5].scriptname||Unassigned_Skill>[quantity=1]] [i@<player.inventory.slot[6].scriptname||Unassigned_Skill>[quantity=1]] [] [] [i@Exit_Icon]"


Berserker_Skills_Menu_Handler:
  type: world
  debug: false
  events:
    on player clicks in Berserker_Skills_Menu:
    - determine cancelled
    on player drags in Berserker_Skills_Menu:
    - determine cancelled
    on player clicks Cleave in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Battle_Cry in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Overpower in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Leap in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Axe_Throw in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Hamstring in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Enraged_Regeneration in Berserker_Skills_Menu:
    - inject Selection_Process
    on player clicks Exit_Icon in Berserker_Skills_Menu:
    - inventory close
    on player closes Berserker_Skills_Menu:
    - inject Skill_Bar_Management

Hamstring:
  type: item
  debug: false
  material: 318
  display name: <&c><&l>Hamstring
  lore:
  - <&a>Optional Skill
  - <&2>Type<&co> <&a>[On-Hit] <&6>Slow + Debuff
  - <&2>Description<&co> <&6>Slow target and decrease melee damage.

Hamstring_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - flag player Hamstring_Effect duration:5s

Hamstring_Effect:
  type: world
  debug: false
  events:
    on player damages entity:
    - if <context.damager.flag[Class]> == Berserker && <context.damager.has_flag[Hamstring_Effect]> {
      - flag <context.damager> Hamstring_Effect:!
      - define Target <context.entity>
      - cast slow <def[Target]> duration:<s@Berserker_Skill_Config.yaml_key[Hamstring_Duration].as_duration||6s> power:<s@Berserker_Skill_Config.yaml_key[Hamstring_Power].as_int||1> hide_particles
      - hurt <s@Berserker_Skill_Config.yaml_key[Hamstring_Damage].as_int||15> <def[Target]>
    }

Enraged_Regeneration:
  type: item
  debug: false
  material: 377 
  display name: <&c><&l>Enraged Regeneration
  lore:
  - <&a>Optional Skill
  - <&2>Type<&co> <&a>[Self Targeted] <&6>Survivability
  - <&2>Description<&co> <&6>Channel your anger into restoring
  - <&6>your health over the duration of the skill.
  - <&sp>
  - <&6>Only usable while &e&oEnraged!

Enraged_Regeneration_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - if !<player.has_flag[Enraged]> {
      - narrate "<&a><&l>[Skill] <&7>You are not <&f>Enraged<&7>!"
      - queue clear
    }
    - run HoT_Effect def:<player.health.max.mul[<s@Berserker_Skill_Config.yaml_key[Enraged_Regeneration_Heal_Procentage].as_decimal||0.05>]>|<s@Berserker_Skill_Config.yaml_key[Enraged_Regeneration_Repeat].as_int||5>|<s@Berserker_Skill_Config.yaml_key[Enraged_Regeneration_Interval].as_int||2> player:<player>

Axe_Throw:
  type: item
  debug: false
  material: 279
  display name: <&c><&l>Axe Throw
  lore:
  - <&a>Optional Skill
  - <&2>Type<&co> <&a>[Skill Shot] <&6>DoT
  - <&2>Description<&co> <&6>Hurl an axe in the direction that you 
  - <&6>are facing, dealing damage for a duration to the 
  - <&6>target that it hits.

Axe_Throw_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - shoot e@item_projectile[item=i@279] origin:<player.location.add[0,1.3,0]> speed:1.8 shooter:<player> script:Axe_Throw_Effect no_rotate

Axe_Throw_Effect:
  type: task
  debug: false
  speed: 0
  script:
    - remove <def[last_entity]>
    - if <def[hit_entities].is_empty> {
      - queue clear
    }
    - define Target <def[hit_entities].get[1]||null>
    - if <def[hit_entities].get[1]> == <player> {
      - define Target <player.target.within[4]||null>
    }
    - if <def[Target]> == null {
      - queue clear
    }
    - repeat <s@Berserker_Skill_Config.yaml_key[Axe_Throw_Ticks].as_int||5> {
      - if <def[Target].health||null> == null {
        - queue clear
      }
      - hurt <s@Berserker_Skill_Config.yaml_key[Axe_Throw_Damage].as_int||5> <def[Target]> cause:custom
      - playeffect <def[Target].location> effect:iconcrack_331 quantity:10 offset:0.3
      - wait <s@Berserker_Skill_Config.yaml_key[Axe_Throw_Period].as_duration||2s>
    }

Leap:
  type: item
  debug: false
  material: 443
  display name: <&c><&l>Leap 
  lore:
  - <&a>Optional Skill
  - <&sp>
  - <&2>Type<&co> <&a>[Launch] <&6>Mobility
  - <&2>Description<&co> <&6>Leap forward stunning everybody
  - <&6>where you land, dealing damage to them and
  - <&6>generating rage.

## <player.location.add[<player.location.direction.vector.add[0,0.5,0].mul[1.5]>]> ##
Leap_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - if <player.location.below.material> != m@air || <player.location.material> != m@air {
      - push <player> origin:<player.location> destination:<player.location.add[<l@0,0,0.with_pose[-20,<player.location.yaw>].direction.vector.mul[3]>]> speed:1.75 duration:1t script:Leap_Effect no_damage no_rotate
    }
    else {
      - narrate "<&a><&l>[Skill] <&7>You cannot you this ability while you are midair!"
      - queue clear
    }

Leap_Effect:
  type: task
  debug: false
  speed: 0
  script:
    - flag player In_Air duration:10s
    - wait 10t
    - while <player.has_flag[In_Air]> {      
      - if <player.location.below.material> != m@air {
        - flag player In_Air:!
      }
      - wait 1t
    }
    - foreach <player.location.find.living_entities.within[<s@Berserker_Skill_Config.yaml_key[Leap_Radius].as_decimal||2>].exclude[<player>]> {
      - define Target <def[Value]>
      - run Stun_Effect def:<s@Berserker_Skill_Config.yaml_key[Overpower_Stun_Duration].as_decimal||2.5>|<def[Target]>
      - hurt <s@Berserker_Skill_Config.yaml_key[Leap_Damage].as_int||5> <def[Target]> cause:custom 
    }
    - define Location <player.location.below>
    - playsound <def[Location]> sound:ENTITY_ENDERDRAGON_FIREBALL_EXPLODE volume:50 pitch:1
    - repeat 4 {
      - playeffect <def[Location]> effect:LAVA visibility:25 quantity:20 offset:1.0,0,1.0 
      - wait 1t
    }

Overpower:
  type: item
  debug: false
  material: 385
  display name: <&c><&l>Overpower
  lore:
  - <&e>Default Skill
  - <&sp> 
  - <&2>Type<&co> <&a>[Targeted] <&6>Damage and CC
  - <&2>Description<&co> <&6>Dash forward bashing into 
  - <&6>the target stunning and dealing damage.
  - <&sp>
  - <&6>Only usable while <&e><&o>Enraged!

Overpower_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - if !<player.has_flag[Enraged]> {
      - narrate "<&a><&l>[Skill] <&7>You are not <&f>Enraged<&7>!"
      - queue clear
    }
    - define target <player.target.within[<s@Berserker_Skill_Config.yaml_key[Overpower_Range].as_int||5>]>
    - if <def[target]> != null {
      - if <def[target].entity_type> == ARMOR_STAND {
        - define new_target <def[target].location.find.living_entities.within[1].exclude[<player>|<def[target]>].get[1]>
        - run Stun_Effect def:<s@Berserker_Skill_Config.yaml_key[Overpower_Stun_Duration].as_decimal||2>|<def[new_target]>
        - push <player> destination:<def[new_target].location.add[0,0.3,0]> speed:0.8 duration:1t no_rotate no_damage
        - hurt <s@Berserker_Skill_Config.yaml_key[Overpower_Damage].as_int||15> <def[new_target]> cause:custom 
        - playeffect <def[new_target].location.add[0,1,0]> effect:blockcrack_152 visibility:25 quantity:15 offset:0.4
        - define target <def[new_target]>
      }
      else {
        - run Stun_Effect def:<s@Berserker_Skill_Config.yaml_key[Overpower_Stun_Duration].as_decimal||2>|<def[target]>
        - push <player> destination:<def[target].location.add[0,0.3,0]> speed:0.8 duration:1t no_rotate no_damage
        - hurt <s@Berserker_Skill_Config.yaml_key[Overpower_Damage].as_int||15> <def[target]> cause:custom 
        - playeffect <def[target].location.add[0,1,0]> effect:blockcrack_152 visibility:25 quantity:15 offset:0.4
      }
    }
    else {
      - queue clear
    }

Battle_Cry:
  type: item
  debug: false
  material: 2260
  display name: <&c><&l>Battle Cry
  lore:
  - <&e>Default Skill
  - <&sp>
  - <&2>Type<&co> <&a>[Self Cast] <&6>Damage buff + AoE interrupt
  - <&2>Description<&co> <&6>Let out a terrifying howl interrupting 
  - <&6>nearby enemies. 
  - <&sp>
  - <&6>Additionally if you are carrying an axe in your 
  - <&6>off-hand you will also gain a physical damage 
  - <&6>increase. While the effect is active you will be 
  - <&6>considered <&e><&o>Enraged<&6>, lasting the duration of 
  - <&6>the buff.

Battle_Cry_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - playeffect <player.location.add[0,1,0]> effect:NOTE visibility:25 quantity:5 offset:0.4
    - playsound <player.location> sound:ENTITY_POLAR_BEAR_WARNING volume:1.5 pitch:0.7
    - flag player Enraged duration:<s@Berserker_Skill_Config.yaml_key[Battle_Cry_Duration].as_int||6>
    - run Damage_Boost_Effect def:<s@Berserker_Skill_Config.yaml_key[Battle_Cry_Duration].as_int||6>|<s@Berserker_Skill_Config.yaml_key[Battle_Cry_Buff].as_decimal||0.2>

Cleave:
  type: item
  debug: false
  material: iron_axe
  display name: <&c><&l>Cleave
  lore:
  - <&e>Default Skill
  - <&sp>
  - <&2>Type<&co> <&a>[Cone Attack] <&6>Cone damage 
  - <&2>Description<&co> <&6>Do a powerful cleaving strike 
  - <&6>dealing damage to all enemies in front of you.

Cleave_Cast:
  type: task
  debug: false
  speed: 0
  script:
    - playeffect <player.location.cursor_on[2].sub[0,0.5,0]> effect:SWEEP_ATTACK quantity:2 offset:0.2
    - foreach <player.location.find.living_entities.within[<s@Berserker_Skill_Config.yaml_key[Cleave_Range].as_int||6>].exclude[<player>]> {
      - if <player.location.facing[<def[Value]>]> {
        - hurt <s@Berserker_Skill_Config.yaml_key[Cleave_Damage].as_int||5> <def[Value]> cause:custom
      }
    }

Inner_Rage:
  type: item
  debug: false
  material: red_dye
  display name: <&c><&l>Inner Rage
  lore:
  - <&e>Default Skill
  - <&sp>
  - <&2>Type<&co> <&a>[Passive] <&6>Resource Generation
  - <&2>Description<&co> <&6>Each melee attack will grant you
  - <&6>rage, which you can spent on abilities.
  - <&sp>
  - <&6>Additionally your attacks have chance to make you
  - <&e><&o>Enraged <&6>for a short duration.
